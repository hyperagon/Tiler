"""
Now fix the script to output proper RAWR (Glaxnimate file). Base yourself on this for corners=3 CHANGE ONLY TRIANGLE RELATED STUFF:

{
    "assets": {
        "__type__": "Assets",
        "colors": {
            "__type__": "NamedColorList",
            "name": "",
            "uuid": "cf4906a4-59f1-4785-89fc-32f6e0ad57d2",
            "values": [
            ]
        },
        "compositions": {
            "__type__": "CompositionList",
            "name": "",
            "uuid": "22665779-4fd7-4930-b661-36281283de97",
            "values": [
                {
                    "__type__": "Composition",
                    "animation": {
                        "__type__": "AnimationContainer",
                        "first_frame": 0,
                        "last_frame": 180
                    },
                    "fps": 60,
                    "group_color": "#00000000",
                    "height": 720,
                    "locked": false,
                    "name": "Composition",
                    "shapes": [
                        {
                            "__type__": "Layer",
                            "animation": {
                                "__type__": "AnimationContainer",
                                "first_frame": 0,
                                "last_frame": 180
                            },
                            "auto_orient": false,
                            "group_color": "#00000000",
                            "locked": false,
                            "mask": {
                                "__type__": "MaskSettings",
                                "inverted": false,
                                "mask": "NoMask"
                            },
                            "name": "Resize 1",
                            "opacity": {
                                "value": 1
                            },
                            "parent": null,
                            "render": true,
                            "shapes": [
                                {
                                    "__type__": "Layer",
                                    "animation": {
                                        "__type__": "AnimationContainer",
                                        "first_frame": 0,
                                        "last_frame": 180
                                    },
                                    "auto_orient": false,
                                    "group_color": "#00000000",
                                    "locked": false,
                                    "mask": {
                                        "__type__": "MaskSettings",
                                        "inverted": false,
                                        "mask": "NoMask"
                                    },
                                    "name": "Resize",
                                    "opacity": {
                                        "value": 1
                                    },
                                    "parent": null,
                                    "render": true,
                                    "shapes": [
                                        {
                                            "__type__": "Layer",
                                            "animation": {
                                                "__type__": "AnimationContainer",
                                                "first_frame": 0,
                                                "last_frame": 180
                                            },
                                            "auto_orient": false,
                                            "group_color": "#00000000",
                                            "locked": false,
                                            "mask": {
                                                "__type__": "MaskSettings",
                                                "inverted": false,
                                                "mask": "NoMask"
                                            },
                                            "name": "Layer",
                                            "opacity": {
                                                "value": 1
                                            },
                                            "parent": null,
                                            "render": true,
                                            "shapes": [
                                            ],
                                            "transform": {
                                                "__type__": "Transform",
                                                "anchor_point": {
                                                    "value": {
                                                        "x": 256,
                                                        "y": 256
                                                    }
                                                },
                                                "position": {
                                                    "value": {
                                                        "x": 256,
                                                        "y": 256
                                                    }
                                                },
                                                "rotation": {
                                                    "value": 0
                                                },
                                                "scale": {
                                                    "value": {
                                                        "x": 1,
                                                        "y": 1
                                                    }
                                                }
                                            },
                                            "uuid": "7c3cc7f1-0fe1-4584-88cd-455a0161c6b8",
                                            "visible": true
                                        },
                                        {
                                            "__type__": "Group",
                                            "auto_orient": false,
                                            "group_color": "#00000000",
                                            "locked": false,
                                            "name": "Path",
                                            "opacity": {
                                                "value": 1
                                            },
                                            "shapes": [
                                                {
                                                    "__type__": "Fill",
                                                    "color": {
                                                        "value": "#ffffff"
                                                    },
                                                    "fill_rule": "NonZero",
                                                    "group_color": "#00000000",
                                                    "locked": false,
                                                    "name": "Fill",
                                                    "opacity": {
                                                        "value": 1
                                                    },
                                                    "use": null,
                                                    "uuid": "8b3ac6f5-70fb-4160-86a1-006fa7058d9d",
                                                    "visible": true
                                                },
                                                {
                                                    "__type__": "Stroke",
                                                    "cap": "ButtCap",
                                                    "color": {
                                                        "value": "#000000"
                                                    },
                                                    "group_color": "#00000000",
                                                    "join": "MiterJoin",
                                                    "locked": false,
                                                    "miter_limit": 4,
                                                    "name": "Stroke",
                                                    "opacity": {
                                                        "value": 1
                                                    },
                                                    "use": null,
                                                    "uuid": "bb83e285-1e58-45cb-940a-2351d600f553",
                                                    "visible": true,
                                                    "width": {
                                                        "value": 10
                                                    }
                                                },
                                                {
                                                    "__type__": "Path",
                                                    "closed": true,
                                                    "group_color": "#00000000",
                                                    "locked": false,
                                                    "name": "Path",
                                                    "reversed": false,
                                                    "shape": {
                                                        "value": {
                                                            "closed": true,
                                                            "points": [
                                                                {
                                                                    "pos": {
                                                                        "x": 1279.9104339959072,
                                                                        "y": 663.3196549251671
                                                                    },
                                                                    "tan_in": {
                                                                        "x": 1279.9104339959072,
                                                                        "y": 663.3196549251671
                                                                    },
                                                                    "tan_out": {
                                                                        "x": 1279.9104339959072,
                                                                        "y": 663.3196549251671
                                                                    },
                                                                    "type": 0
                                                                },
                                                                {
                                                                    "pos": {
                                                                        "x": 1254.3734897215459,
                                                                        "y": 723.7881110090455
                                                                    },
                                                                    "tan_in": {
                                                                        "x": 1254.3734897215459,
                                                                        "y": 723.7881110090455
                                                                    },
                                                                    "tan_out": {
                                                                        "x": 1254.3734897215459,
                                                                        "y": 723.7881110090455
                                                                    },
                                                                    "type": 1
                                                                },
                                                                {
                                                                    "pos": {
                                                                        "x": 1304.4965346243896,
                                                                        "y": 725.1498167508281
                                                                    },
                                                                    "tan_in": {
                                                                        "x": 1304.4965346243896,
                                                                        "y": 725.1498167508281
                                                                    },
                                                                    "tan_out": {
                                                                        "x": 1304.4965346243896,
                                                                        "y": 725.1498167508281
                                                                    },
                                                                    "type": 1
                                                                }
                                                            ]
                                                        }
                                                    },
                                                    "uuid": "4782a199-4968-4bb5-acbb-8f4a2922aadb",
                                                    "visible": true
                                                }
                                            ],
                                            "transform": {
                                                "__type__": "Transform",
                                                "anchor_point": {
                                                    "value": {
                                                        "x": 1247.6852276310346,
                                                        "y": 671.9892556688972
                                                    }
                                                },
                                                "position": {
                                                    "value": {
                                                        "x": 887.2428285376246,
                                                        "y": 472.30721902452234
                                                    }
                                                },
                                                "rotation": {
                                                    "value": 0
                                                },
                                                "scale": {
                                                    "value": {
                                                        "x": 0.7111111283302307,
                                                        "y": 0.6037482619285583
                                                    }
                                                }
                                            },
                                            "uuid": "728baec5-e34c-42d2-8a45-9bb1e0ef2f9c",
                                            "visible": true
                                        },
                                        {
                                            "__type__": "Group",
                                            "auto_orient": false,
                                            "group_color": "#00000000",
                                            "locked": false,
                                            "name": "Path 1",
                                            "opacity": {
                                                "value": 1
                                            },
                                            "shapes": [
                                                {
                                                    "__type__": "Fill",
                                                    "color": {
                                                        "value": "#ffffff"
                                                    },
                                                    "fill_rule": "NonZero",
                                                    "group_color": "#00000000",
                                                    "locked": false,
                                                    "name": "Fill 2",
                                                    "opacity": {
                                                        "value": 1
                                                    },
                                                    "use": null,
                                                    "uuid": "473c85af-2431-44f0-861b-bf6f5827b303",
                                                    "visible": true
                                                },
                                                {
                                                    "__type__": "Stroke",
                                                    "cap": "ButtCap",
                                                    "color": {
                                                        "value": "#000000"
                                                    },
                                                    "group_color": "#00000000",
                                                    "join": "MiterJoin",
                                                    "locked": false,
                                                    "miter_limit": 10,
                                                    "name": "Stroke 2",
                                                    "opacity": {
                                                        "value": 1
                                                    },
                                                    "use": null,
                                                    "uuid": "5339c95f-2b0c-48bc-8ce3-63aa27d80971",
                                                    "visible": true,
                                                    "width": {
                                                        "value": 10
                                                    }
                                                },
                                                {
                                                    "__type__": "Path",
                                                    "closed": true,
                                                    "group_color": "#00000000",
                                                    "locked": false,
                                                    "name": "Path 2",
                                                    "reversed": false,
                                                    "shape": {
                                                        "value": {
                                                            "closed": true,
                                                            "points": [
                                                                {
                                                                    "pos": {
                                                                        "x": -0.5586600604661616,
                                                                        "y": 3.8627894565995
                                                                    },
                                                                    "tan_in": {
                                                                        "x": -0.5586600604661616,
                                                                        "y": 3.8627894565995
                                                                    },
                                                                    "tan_out": {
                                                                        "x": -0.5586600604661616,
                                                                        "y": 3.8627894565995
                                                                    },
                                                                    "type": 0
                                                                },
                                                                {
                                                                    "pos": {
                                                                        "x": -27.256739312360565,
                                                                        "y": 62.27982099132876
                                                                    },
                                                                    "tan_in": {
                                                                        "x": -27.256739312360565,
                                                                        "y": 62.27982099132876
                                                                    },
                                                                    "tan_out": {
                                                                        "x": -27.256739312360565,
                                                                        "y": 62.27982099132876
                                                                    },
                                                                    "type": 0
                                                                },
                                                                {
                                                                    "pos": {
                                                                        "x": 22.86630559048306,
                                                                        "y": 62.305963875592425
                                                                    },
                                                                    "tan_in": {
                                                                        "x": 22.86630559048306,
                                                                        "y": 62.305963875592425
                                                                    },
                                                                    "tan_out": {
                                                                        "x": 22.86630559048306,
                                                                        "y": 62.305963875592425
                                                                    },
                                                                    "type": 0
                                                                }
                                                            ]
                                                        }
                                                    },
                                                    "uuid": "589bdcba-b5d9-46b5-953b-33612a915151",
                                                    "visible": true
                                                }
                                            ],
                                            "transform": {
                                                "__type__": "Transform",
                                                "anchor_point": {
                                                    "value": {
                                                        "x": 0,
                                                        "y": 0
                                                    }
                                                },
                                                "position": {
                                                    "value": {
                                                        "x": 0,
                                                        "y": 0
                                                    }
                                                },
                                                "rotation": {
                                                    "value": 0
                                                },
                                                "scale": {
                                                    "value": {
                                                        "x": 0.7111111283302307,
                                                        "y": 0.6037482619285583
                                                    }
                                                }
                                            },
                                            "uuid": "39a8b6be-f7d9-47c0-812a-f1b259fe9333",
                                            "visible": true
                                        }
                                    ],
                                    "transform": {
                                        "__type__": "Transform",
                                        "anchor_point": {
                                            "value": {
                                                "x": 0,
                                                "y": 0
                                            }
                                        },
                                        "position": {
                                            "value": {
                                                "x": 0,
                                                "y": 13.879518072289102
                                            }
                                        },
                                        "rotation": {
                                            "value": 0
                                        },
                                        "scale": {
                                            "value": {
                                                "x": 2.5,
                                                "y": 2.5
                                            }
                                        }
                                    },
                                    "uuid": "caf9cb91-c4f0-4e09-a889-f3a2e584c7f0",
                                    "visible": true
                                }
                            ],
                            "transform": {
                                "__type__": "Transform",
                                "anchor_point": {
                                    "value": {
                                        "x": 0,
                                        "y": 0
                                    }
                                },
                                "position": {
                                    "value": {
                                        "x": 0,
                                        "y": 0
                                    }
                                },
                                "rotation": {
                                    "value": 0
                                },
                                "scale": {
                                    "value": {
                                        "x": 0.5625,
                                        "y": 0.5625
                                    }
                                }
                            },
                            "uuid": "12bd180c-a2c4-4998-997a-9b8156215be6",
                            "visible": true
                        }
                    ],
                    "uuid": "c5657522-3a04-40e7-8ae1-7b455986a0f3",
                    "visible": true,
                    "width": 1280
                },
                {
                    "__type__": "Composition",
                    "animation": {
                        "__type__": "AnimationContainer",
                        "first_frame": 0,
                        "last_frame": -1
                    },
                    "fps": 60,
                    "group_color": "#00000000",
                    "height": 512,
                    "locked": false,
                    "name": "",
                    "shapes": [
                    ],
                    "uuid": "3715db72-b5e9-4168-b669-03d2476fb2e3",
                    "visible": true,
                    "width": 512
                }
            ]
        },
        "fonts": {
            "__type__": "FontList",
            "name": "",
            "uuid": "82cb8edf-59bf-4a5f-86fb-c7e96077cdfb",
            "values": [
            ]
        },
        "gradient_colors": {
            "__type__": "GradientColorsList",
            "name": "",
            "uuid": "aecaf71a-c9d9-4ec6-b80e-16740fa407d8",
            "values": [
                {
                    "__type__": "GradientColors",
                    "colors": {
                        "value": [
                            {
                                "color": "#ffffff",
                                "offset": 0
                            },
                            {
                                "color": "#000000",
                                "offset": 1
                            }
                        ]
                    },
                    "name": "Gradient",
                    "uuid": "dc49db01-ef2d-449e-afe9-5b204bc7396f"
                }
            ]
        },
        "gradients": {
            "__type__": "GradientList",
            "name": "",
            "uuid": "de06e946-8700-4b04-b04d-95ffcb1d5e73",
            "values": [
                {
                    "__type__": "Gradient",
                    "colors": "dc49db01-ef2d-449e-afe9-5b204bc7396f",
                    "end_point": {
                        "value": {
                            "x": 33.330464621079805,
                            "y": 27.9499624688903
                        }
                    },
                    "highlight": {
                        "value": {
                            "x": -27.031631913459606,
                            "y": 27.9499624688903
                        }
                    },
                    "name": "",
                    "start_point": {
                        "value": {
                            "x": -27.031631913459606,
                            "y": 27.9499624688903
                        }
                    },
                    "type": "Radial",
                    "uuid": "0cd40eb6-db1c-4ae2-913f-9b88351f65e6"
                }
            ]
        },
        "images": {
            "__type__": "BitmapList",
            "name": "",
            "uuid": "c6865b5a-4895-4877-8781-7c1c13d38ae5",
            "values": [
            ]
        },
        "name": "",
        "uuid": "cb0fedd3-1d1d-4358-a6ea-441a0beeed30"
    },
    "format": {
        "format_version": 8,
        "generator": "Glaxnimate",
        "generator_version": "0.5.4+appimage-dc26f367"
    },
    "info": {
        "author": "",
        "description": "",
        "keywords": [
        ]
    },
    "metadata": {
    }
}

"""

import json
import math
import uuid
import argparse

def is_shape_visible(vertices, position, rotation, width, height):
    """Check if a shape is at least partially visible within the document boundaries."""
    # Transform vertices to world coordinates
    world_vertices = []
    angle_rad = math.radians(rotation)
    pos_x, pos_y = position
    
    for vx, vy in vertices:
        # Rotate around (0,0)
        rx = vx * math.cos(angle_rad) - vy * math.sin(angle_rad)
        ry = vx * math.sin(angle_rad) + vy * math.cos(angle_rad)
        # Translate to world position
        world_x = rx + pos_x
        world_y = ry + pos_y
        world_vertices.append((world_x, world_y))
    
    # Check if any vertex is inside the document
    for x, y in world_vertices:
        if 0 <= x <= width and 0 <= y <= height:
            return True
    
    # Check if any edge intersects with the document boundaries
    n = len(world_vertices)
    for i in range(n):
        x1, y1 = world_vertices[i]
        x2, y2 = world_vertices[(i+1) % n]
        
        # Check intersection with left boundary (x=0)
        if line_intersects_edge(x1, y1, x2, y2, 'x', 0, 0, height):
            return True
        
        # Check intersection with right boundary (x=width)
        if line_intersects_edge(x1, y1, x2, y2, 'x', width, 0, height):
            return True
        
        # Check intersection with top boundary (y=0)
        if line_intersects_edge(x1, y1, x2, y2, 'y', 0, 0, width):
            return True
        
        # Check intersection with bottom boundary (y=height)
        if line_intersects_edge(x1, y1, x2, y2, 'y', height, 0, width):
            return True
    
    return False

def line_intersects_edge(x1, y1, x2, y2, edge_type, edge_value, min_val, max_val):
    """Check if a line segment intersects with a document boundary edge."""
    if edge_type == 'x':  # Vertical edge (left or right boundary)
        if (x1 <= edge_value and x2 >= edge_value) or (x1 >= edge_value and x2 <= edge_value):
            if x1 == x2:  # Vertical line
                if x1 == edge_value:  # Exactly on the boundary
                    y_min = min(y1, y2)
                    y_max = max(y1, y2)
                    if not (y_max < min_val or y_min > max_val):
                        return True
            else:
                # Calculate y-coordinate at x = edge_value
                t = (edge_value - x1) / (x2 - x1)
                if 0 <= t <= 1:
                    y = y1 + t * (y2 - y1)
                    if min_val <= y <= max_val:
                        return True
    else:  # edge_type == 'y' (top or bottom boundary)
        if (y1 <= edge_value and y2 >= edge_value) or (y1 >= edge_value and y2 <= edge_value):
            if y1 == y2:  # Horizontal line
                if y1 == edge_value:  # Exactly on the boundary
                    x_min = min(x1, x2)
                    x_max = max(x1, x2)
                    if not (x_max < min_val or x_min > max_val):
                        return True
            else:
                # Calculate x-coordinate at y = edge_value
                t = (edge_value - y1) / (y2 - y1)
                if 0 <= t <= 1:
                    x = x1 + t * (x2 - x1)
                    if min_val <= x <= max_val:
                        return True
    return False

def create_triangle_group(name, x, y, rotation, size, fill, stroke, stroke_width, inverted=False):
    """Create a triangle group using Path element with default outline"""
    # Generate UUIDs for group elements
    group_uuid = str(uuid.uuid4())
    fill_uuid = str(uuid.uuid4())
    path_uuid = str(uuid.uuid4())
    stroke_uuid = str(uuid.uuid4())
    
    # Calculate triangle vertices (equilateral triangle)
    height = size * math.sqrt(3) / 2
    
    # Create vertices based on orientation
    if inverted:
        vertices = [
            (0, height/2),              # Bottom point
            (-size/2, -height/2),       # Top left
            (size/2, -height/2)         # Top right
        ]
    else:
        vertices = [
            (0, -height/2),             # Top point
            (-size/2, height/2),        # Bottom left
            (size/2, height/2)          # Bottom right
        ]
    
    # Create vertex objects in the format expected by Glaxnimate
    points = []
    for i, (vx, vy) in enumerate(vertices):
        points.append({
            "pos": {"x": vx, "y": vy},
            "tan_in": {"x": vx, "y": vy},
            "tan_out": {"x": vx, "y": vy},
            "type": 0 if i == 0 else 1  # First point is type 0, others are type 1
        })
    
    # Create the shape group with guaranteed outline
    return {
        "__type__": "Group",
        "auto_orient": False,
        "group_color": "#00000000",
        "locked": False,
        "name": name,
        "opacity": {"value": 1},
        "shapes": [
            {
                "__type__": "Fill",
                "color": {"value": fill},
                "fill_rule": "NonZero",
                "group_color": "#00000000",
                "locked": False,
                "name": "Fill",
                "opacity": {"value": 1},
                "use": None,
                "uuid": fill_uuid,
                "visible": True
            },
            {
                "__type__": "Path",
                "closed": True,
                "group_color": "#00000000",
                "locked": False,
                "name": "Path",
                "reversed": False,
                "shape": {
                    "value": {
                        "closed": True,
                        "points": points
                    }
                },
                "uuid": path_uuid,
                "visible": True
            },
            {
                "__type__": "Stroke",
                "cap": "ButtCap",
                "color": {"value": stroke},
                "group_color": "#00000000",
                "join": "MiterJoin",
                "locked": False,
                "miter_limit": 4,
                "name": "Stroke",
                "opacity": {"value": 1},
                "use": None,
                "uuid": stroke_uuid,
                "visible": True,
                "width": {"value": stroke_width}
            }
        ],
        "transform": {
            "__type__": "Transform",
            "anchor_point": {"value": {"x": 0, "y": 0}},
            "position": {"value": {"x": x, "y": y}},
            "rotation": {"value": rotation},
            "scale": {"value": {"x": 1, "y": 1}}
        },
        "uuid": group_uuid,
        "visible": True
    }

def create_square_group(name, x, y, rotation, size, fill, stroke, stroke_width):
    """Create a square group using Rect element with default outline"""
    # Generate UUIDs for group elements
    group_uuid = str(uuid.uuid4())
    fill_uuid = str(uuid.uuid4())
    rect_uuid = str(uuid.uuid4())
    stroke_uuid = str(uuid.uuid4())
    
    # Create the shape group with guaranteed outline
    return {
        "__type__": "Group",
        "auto_orient": False,
        "group_color": "#00000000",
        "locked": False,
        "name": name,
        "opacity": {"value": 1},
        "shapes": [
            {
                "__type__": "Fill",
                "color": {"value": fill},
                "fill_rule": "NonZero",
                "group_color": "#00000000",
                "locked": False,
                "name": "Fill",
                "opacity": {"value": 1},
                "use": None,
                "uuid": fill_uuid,
                "visible": True
            },
            {
                "__type__": "Rect",
                "group_color": "#00000000",
                "locked": False,
                "name": "Rectangle",
                "position": {"value": {"x": -size/2, "y": -size/2}},
                "reversed": False,
                "rounded": {"value": 0},
                "size": {"value": {"height": size, "width": size}},
                "uuid": rect_uuid,
                "visible": True
            },
            {
                "__type__": "Stroke",
                "cap": "ButtCap",
                "color": {"value": stroke},
                "group_color": "#00000000",
                "join": "MiterJoin",
                "locked": False,
                "miter_limit": 4,
                "name": "Stroke",
                "opacity": {"value": 1},
                "use": None,
                "uuid": stroke_uuid,
                "visible": True,
                "width": {"value": stroke_width}
            }
        ],
        "transform": {
            "__type__": "Transform",
            "anchor_point": {"value": {"x": 0, "y": 0}},
            "position": {"value": {"x": x, "y": y}},
            "rotation": {"value": rotation},
            "scale": {"value": {"x": 1, "y": 1}}
        },
        "uuid": group_uuid,
        "visible": True
    }

def create_hexagon_group(name, x, y, rotation, radius, fill, stroke, stroke_width):
    """Create a hexagon group using PolyStar element with default outline"""
    # Generate UUIDs for group elements
    group_uuid = str(uuid.uuid4())
    fill_uuid = str(uuid.uuid4())
    polystar_uuid = str(uuid.uuid4())
    stroke_uuid = str(uuid.uuid4())
    
    # Create the shape group with guaranteed outline
    return {
        "__type__": "Group",
        "auto_orient": False,
        "group_color": "#00000000",
        "locked": False,
        "name": name,
        "opacity": {"value": 1},
        "shapes": [
            {
                "__type__": "Fill",
                "color": {"value": fill},
                "fill_rule": "NonZero",
                "group_color": "#00000000",
                "locked": False,
                "name": "Fill",
                "opacity": {"value": 1},
                "use": None,
                "uuid": fill_uuid,
                "visible": True
            },
            {
                "__type__": "PolyStar",
                "angle": {"value": 0},
                "group_color": "#00000000",
                "inner_radius": {"value": radius},
                "inner_roundness": {"value": 0},
                "locked": False,
                "name": "PolyStar",
                "outer_radius": {"value": radius},
                "outer_roundness": {"value": 0},
                "points": {"value": 6},
                "position": {"value": {"x": 0, "y": 0}},
                "reversed": False,
                "type": "Polygon",
                "uuid": polystar_uuid,
                "visible": True
            },
            {
                "__type__": "Stroke",
                "cap": "ButtCap",
                "color": {"value": stroke},
                "group_color": "#00000000",
                "join": "MiterJoin",
                "locked": False,
                "miter_limit": 4,
                "name": "Stroke",
                "opacity": {"value": 1},
                "use": None,
                "uuid": stroke_uuid,
                "visible": True,
                "width": {"value": stroke_width}
            }
        ],
        "transform": {
            "__type__": "Transform",
            "anchor_point": {"value": {"x": 0, "y": 0}},
            "position": {"value": {"x": x, "y": y}},
            "rotation": {"value": rotation},
            "scale": {"value": {"x": 1, "y": 1}}
        },
        "uuid": group_uuid,
        "visible": True
    }

def generate_rawr(width, height, corners, tile_size, rotation, fill, stroke, stroke_width):
    """Generate a RAWR file with tiled shapes"""
    # Generate UUIDs for top-level elements
    assets_uuid = str(uuid.uuid4())
    colors_uuid = str(uuid.uuid4())
    compositions_uuid = str(uuid.uuid4())
    composition_uuid = str(uuid.uuid4())
    fonts_uuid = str(uuid.uuid4())
    gradient_colors_uuid = str(uuid.uuid4())
    gradients_uuid = str(uuid.uuid4())
    images_uuid = str(uuid.uuid4())
    
    # Generate the grid of shapes
    shapes = []
    shape_index = 0
    
    if corners == 3:  # Triangular tiling
        # Calculate dimensions for equilateral triangles
        triangle_height = tile_size * math.sqrt(3) / 2
        horizontal_spacing = tile_size / 2
        vertical_spacing = triangle_height
        
        # Calculate grid dimensions with margin for rotation
        rows = math.ceil(height / vertical_spacing) + 4
        cols = math.ceil(width / horizontal_spacing) + 4
        
        # Starting position to center the pattern
        start_x = (width - (cols-1) * horizontal_spacing) / 2
        start_y = (height - (rows-1) * vertical_spacing) / 2
        
        for row in range(rows):
            for col in range(cols):
                # Calculate position
                x = start_x + col * horizontal_spacing
                y = start_y + row * vertical_spacing
                
                # Offset every other row
                if row % 2 == 1:
                    x += horizontal_spacing / 2
                
                # Alternate between up and down triangles
                inverted = (row + col) % 2 == 1
                
                # Create triangle vertices
                if inverted:
                    vertices = [
                        (0, triangle_height/2),              # Bottom point
                        (-tile_size/2, -triangle_height/2),  # Top left
                        (tile_size/2, -triangle_height/2)     # Top right
                    ]
                else:
                    vertices = [
                        (0, -triangle_height/2),             # Top point
                        (-tile_size/2, triangle_height/2),   # Bottom left
                        (tile_size/2, triangle_height/2)     # Bottom right
                    ]
                
                # Check if the shape is visible within the document
                if is_shape_visible(vertices, (x, y), rotation, width, height):
                    # Create the shape group
                    shape_group = create_triangle_group(
                        f"Triangle {shape_index}", x, y, rotation, 
                        tile_size, fill, stroke, stroke_width, inverted
                    )
                    shapes.append(shape_group)
                    shape_index += 1
    
    elif corners == 4:  # Square tiling
        # Calculate grid dimensions with margin for rotation
        rows = math.ceil(height / tile_size) + 4
        cols = math.ceil(width / tile_size) + 4
        
        # Starting position to center the pattern
        start_x = (width - (cols-1) * tile_size) / 2
        start_y = (height - (rows-1) * tile_size) / 2
        
        for row in range(rows):
            for col in range(cols):
                # Calculate position
                x = start_x + col * tile_size + tile_size/2
                y = start_y + row * tile_size + tile_size/2
                
                # Create square vertices
                vertices = [
                    (-tile_size/2, -tile_size/2),  # Top left
                    (tile_size/2, -tile_size/2),   # Top right
                    (tile_size/2, tile_size/2),    # Bottom right
                    (-tile_size/2, tile_size/2)    # Bottom left
                ]
                
                # Check if the shape is visible within the document
                if is_shape_visible(vertices, (x, y), rotation, width, height):
                    # Create the shape group
                    shape_group = create_square_group(
                        f"Square {shape_index}", x, y, rotation, 
                        tile_size, fill, stroke, stroke_width
                    )
                    shapes.append(shape_group)
                    shape_index += 1
    
    elif corners == 6:  # Hexagonal tiling
        # Calculate hexagon dimensions
        hex_radius = tile_size
        hex_width = hex_radius * math.sqrt(3)  # Width of hexagon (flat to flat)
        hex_height = hex_radius * 2  # Height of hexagon (point to point)
        
        # Calculate spacing between hexagon centers
        horizontal_spacing = hex_width
        vertical_spacing = hex_height * 0.75
        
        # Calculate grid dimensions with margin for rotation
        rows = math.ceil(height / vertical_spacing) + 4
        cols = math.ceil(width / horizontal_spacing) + 4
        
        # Starting position to center the pattern
        start_x = (width - (cols-1) * horizontal_spacing) / 2
        start_y = (height - (rows-1) * vertical_spacing) / 2
        
        for row in range(rows):
            for col in range(cols):
                # Calculate position
                x = start_x + col * horizontal_spacing
                y = start_y + row * vertical_spacing
                
                # Offset every other row
                if row % 2 == 1:
                    x += horizontal_spacing / 2
                
                # Create hexagon vertices
                vertices = []
                for i in range(6):
                    angle = math.pi / 3 * i  # 60 degrees in radians
                    # Rotate by 30 degrees to get flat top
                    angle += math.pi / 6
                    px = hex_radius * math.cos(angle)
                    py = hex_radius * math.sin(angle)
                    vertices.append((px, py))
                
                # Check if the shape is visible within the document
                if is_shape_visible(vertices, (x, y), rotation, width, height):
                    # Create the shape group
                    shape_group = create_hexagon_group(
                        f"Hexagon {shape_index}", x, y, rotation, 
                        hex_radius, fill, stroke, stroke_width
                    )
                    shapes.append(shape_group)
                    shape_index += 1
    
    else:
        raise ValueError("Number of corners must be 3, 4, or 6.")
    
    # Build the composition
    composition = {
        "__type__": "Composition",
        "animation": {
            "__type__": "AnimationContainer",
            "first_frame": 0,
            "last_frame": 180
        },
        "fps": 60,
        "group_color": "#00000000",
        "height": height,
        "locked": False,
        "name": "Composition",
        "shapes": shapes,
        "uuid": composition_uuid,
        "visible": True,
        "width": width
    }
    
    # Build the assets
    assets = {
        "__type__": "Assets",
        "colors": {
            "__type__": "NamedColorList",
            "name": "",
            "uuid": colors_uuid,
            "values": []
        },
        "compositions": {
            "__type__": "CompositionList",
            "name": "",
            "uuid": compositions_uuid,
            "values": [composition]
        },
        "fonts": {
            "__type__": "FontList",
            "name": "",
            "uuid": fonts_uuid,
            "values": []
        },
        "gradient_colors": {
            "__type__": "GradientColorsList",
            "name": "",
            "uuid": gradient_colors_uuid,
            "values": []
        },
        "gradients": {
            "__type__": "GradientList",
            "name": "",
            "uuid": gradients_uuid,
            "values": []
        },
        "images": {
            "__type__": "BitmapList",
            "name": "",
            "uuid": images_uuid,
            "values": []
        },
        "name": "",
        "uuid": assets_uuid
    }
    
    # Build the RAWR structure
    rawr_dict = {
        "assets": assets,
        "format": {
            "format_version": 8,
            "generator": "Glaxnimate",
            "generator_version": "0.5.4+appimage-dc26f367"
        },
        "info": {
            "author": "",
            "description": "",
            "keywords": []
        },
        "metadata": {}
    }
    
    return json.dumps(rawr_dict, indent=4)

def main():
    parser = argparse.ArgumentParser(description="Generate a RAWR (Glaxnimate) file with tiled shapes.")
    parser.add_argument('--width', type=int, default=1280, help="Width of the canvas (default: 1280)")
    parser.add_argument('--height', type=int, default=720, help="Height of the canvas (default: 720)")
    parser.add_argument('--corners', type=int, choices=[3, 4, 6], required=True, help="Number of corners of the tile (3, 4, or 6)")
    parser.add_argument('--tile_size', type=float, default=50, help="Size of each tile (default: 50)")
    parser.add_argument('--rotation', type=float, default=0, help="Rotation angle in degrees (default: 0)")
    parser.add_argument('--fill', type=str, default="white", help="Fill color of the tiles (default: white)")
    parser.add_argument('--stroke', type=str, default="black", help="Stroke color of the tiles (default: black)")
    parser.add_argument('--stroke_width', type=float, default=1, help="Stroke width of the tiles (default: 1)")
    parser.add_argument('--output', type=str, default="output.rawr", help="Output RAWR file name (default: output.rawr)")
    
    args = parser.parse_args()
    
    rawr_content = generate_rawr(
        args.width, args.height, args.corners,
        args.tile_size, args.rotation, args.fill, args.stroke, args.stroke_width
    )
    
    with open(args.output, 'w') as f:
        f.write(rawr_content)
    
    print(f"RAWR file '{args.output}' generated successfully.")

if __name__ == "__main__":
    main()
